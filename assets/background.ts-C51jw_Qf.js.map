{"version":3,"file":"background.ts-C51jw_Qf.js","sources":["../../src/pages/auth/background.ts"],"sourcesContent":["const getNonce = () =>\n\tMath.random().toString(36).substring(2, 15) +\n\tMath.random().toString(36).substring(2, 15)\n\nexport function getAuthUrl() {\n\tconst params = new URLSearchParams({\n\t\tclient_id: import.meta.env.VITE_CRX_CLIENT_ID,\n\t\tresponse_type: 'id_token',\n\t\tredirect_uri: chrome.identity.getRedirectURL(),\n\t\tstate: 'jfkls3n',\n\t\tscope: ['openid', 'email', 'profile'].join(' '),\n\t\tprompt: 'consent',\n\t\tnonce: getNonce(),\n\t})\n\n\treturn `https://accounts.google.com/o/oauth2/v2/auth?${params}`\n}\n\nchrome.runtime.onMessage.addListener((request, _, sendResponse) => {\n\tif (request.action === 'login') {\n\t\tchrome.identity.launchWebAuthFlow(\n\t\t\t{\n\t\t\t\turl: getAuthUrl(),\n\t\t\t\tinteractive: true,\n\t\t\t},\n\t\t\t(responseUrl) => {\n\t\t\t\tif (!responseUrl) return false\n\n\t\t\t\tconst url = new URL(responseUrl)\n\t\t\t\tconst params = new URLSearchParams(url.hash.substring(1))\n\t\t\t\tconst token = params.get('id_token')\n\n\t\t\t\tif (!token) return false\n\n\t\t\t\tchrome.storage.local.set({ token })\n\n\t\t\t\tsendResponse(token)\n\t\t\t},\n\t\t)\n\n\t\t// This is required so emitter waits for async response\n\t\treturn true\n\t}\n})\n"],"names":["getNonce","getAuthUrl","request","_","sendResponse","responseUrl","url","token"],"mappings":"8WAAA,MAAMA,EAAW,IAChB,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,UAAU,EAAG,EAAE,EAC1C,KAAK,SAAS,SAAS,EAAE,EAAE,UAAU,EAAG,EAAE,EAEpC,SAASC,GAAa,CAW5B,MAAO,gDAVQ,IAAI,gBAAgB,CAClC,UAAW,0EACX,cAAe,WACf,aAAc,OAAO,SAAS,eAAe,EAC7C,MAAO,UACP,MAAO,CAAC,SAAU,QAAS,SAAS,EAAE,KAAK,GAAG,EAC9C,OAAQ,UACR,MAAOD,EAAS,CAAA,CAChB,CAE4D,EAC9D,CAEA,OAAO,QAAQ,UAAU,YAAY,CAACE,EAASC,EAAGC,IAAiB,CAC9D,GAAAF,EAAQ,SAAW,QACtB,cAAO,SAAS,kBACf,CACC,IAAKD,EAAW,EAChB,YAAa,EACd,EACCI,GAAgB,CACZ,GAAA,CAACA,EAAoB,MAAA,GAEnB,MAAAC,EAAM,IAAI,IAAID,CAAW,EAEzBE,EADS,IAAI,gBAAgBD,EAAI,KAAK,UAAU,CAAC,CAAC,EACnC,IAAI,UAAU,EAE/B,GAAA,CAACC,EAAc,MAAA,GAEnB,OAAO,QAAQ,MAAM,IAAI,CAAE,MAAAA,EAAO,EAElCH,EAAaG,CAAK,CAAA,CAEpB,EAGO,EAET,CAAC"}